[target.thumbv7em-none-eabihf]
# flip-link flips the memory layout so the stack is placed BELOW .bss+.data.
# A stack overflow therefore hits the bottom of RAM (HardFault) instead of
# silently corrupting DMA buffers in AXI SRAM.
# Install: cargo install flip-link
linker = "flip-link"
runner = "probe-rs run --chip STM32H743ZITx"
rustflags = [
  "-C", "link-arg=-Tlink.x",
  "-C", "link-arg=-Tdefmt.x",
]

# [build]
# Note: Commented out to allow emulator builds
# Specify --target thumbv7em-none-eabihf explicitly for hardware builds
# target = "thumbv7em-none-eabihf"

[env]
DEFMT_LOG = "info"

[alias]
# xtask commands (primary development workflow)
flash = "run -p xtask -- flash"
dev   = "run -p xtask -- dev"

# Hardware design (Atopile) â€” cargo hw <check|build|sync|bom>
hw = "run -p xtask -- hardware"

# Quick commands
rb = "build --release"
rr = "run --release"
size = "size --release --bin firmware -- -A"

# Testing
test-unit = "test --lib"
test-integration = "test --test integration"
test-all = "test --workspace --all-features"

# Analysis
bloat = "bloat --release --bin firmware"
expand = "expand --lib"
check-embedded = "check --target thumbv7em-none-eabihf --no-default-features"
